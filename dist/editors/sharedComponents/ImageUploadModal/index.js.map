{"version":3,"file":"index.js","names":["_react","_interopRequireDefault","require","_propTypes","_i18n","_tinyMCE","_ImageSettingsModal","_SelectImageModal","_module","_interopRequireWildcard","_jsxRuntime","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","propsString","exports","props","keys","map","concat","join","imgProps","_ref","settings","selection","lmsEndpointUrl","editorType","url","externalUrl","startsWith","sourceEndIndex","length","substring","src","alt","isDecorative","altText","width","dimensions","height","hooks","createSaveCallback","_ref2","close","editorRef","setSelection","current","execCommand","tinyMCEKeys","commands","insertContent","module","imgTag","onClose","_ref3","clearSelection","_ref4","ImageUploadModal","_ref5","isOpen","images","jsx","saveToEditor","returnToSelection","defaultProps","propTypes","PropTypes","func","isRequired","oneOfType","shape","any","bool","string","_default","injectIntl"],"sources":["../../../../src/editors/sharedComponents/ImageUploadModal/index.jsx"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { injectIntl } from '@edx/frontend-platform/i18n';\nimport tinyMCEKeys from '../../data/constants/tinyMCE';\nimport ImageSettingsModal from './ImageSettingsModal';\nimport SelectImageModal from './SelectImageModal';\nimport * as module from '.';\n\nexport const propsString = (props) => (\n  Object.keys(props).map((key) => `${key}=\"${props[key]}\"`).join(' ')\n);\n\nexport const imgProps = ({\n  settings,\n  selection,\n  lmsEndpointUrl,\n  editorType,\n}) => {\n  let url = selection.externalUrl;\n  if (url.startsWith(lmsEndpointUrl) && editorType !== 'expandable') {\n    const sourceEndIndex = lmsEndpointUrl.length;\n    url = url.substring(sourceEndIndex);\n  }\n  return {\n    src: url,\n    alt: settings.isDecorative ? '' : settings.altText,\n    width: settings.dimensions.width,\n    height: settings.dimensions.height,\n  };\n};\n\nexport const hooks = {\n  createSaveCallback: ({\n    close,\n    editorRef,\n    editorType,\n    setSelection,\n    selection,\n    lmsEndpointUrl,\n  }) => (\n    settings,\n  ) => {\n    editorRef.current.execCommand(\n      tinyMCEKeys.commands.insertContent,\n      false,\n      module.hooks.imgTag({\n        settings,\n        selection,\n        lmsEndpointUrl,\n        editorType,\n      }),\n    );\n    setSelection(null);\n    close();\n  },\n  onClose: ({ clearSelection, close }) => () => {\n    clearSelection();\n    close();\n  },\n  imgTag: ({\n    settings,\n    selection,\n    lmsEndpointUrl,\n    editorType,\n  }) => {\n    const props = module.imgProps({\n      settings,\n      selection,\n      lmsEndpointUrl,\n      editorType,\n    });\n    return `<img ${propsString(props)} />`;\n  },\n};\n\nexport const ImageUploadModal = ({\n  // eslint-disable-next-line\n  editorRef,\n  isOpen,\n  close,\n  clearSelection,\n  selection,\n  setSelection,\n  images,\n  editorType,\n  lmsEndpointUrl,\n}) => {\n  if (selection) {\n    return (\n      <ImageSettingsModal\n        {...{\n          isOpen,\n          close: module.hooks.onClose({ clearSelection, close }),\n          selection,\n          saveToEditor: module.hooks.createSaveCallback({\n            close,\n            editorRef,\n            editorType,\n            selection,\n            setSelection,\n            lmsEndpointUrl,\n          }),\n          returnToSelection: clearSelection,\n        }}\n      />\n    );\n  }\n  return (\n    <SelectImageModal\n      {...{\n        isOpen,\n        close,\n        setSelection,\n        clearSelection,\n        images,\n      }}\n    />\n  );\n};\n\nImageUploadModal.defaultProps = {\n  editorRef: null,\n  editorType: null,\n  selection: null,\n};\nImageUploadModal.propTypes = {\n  clearSelection: PropTypes.func.isRequired,\n  close: PropTypes.func.isRequired,\n  editorRef: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.shape({ current: PropTypes.any }),\n  ]),\n  isOpen: PropTypes.bool.isRequired,\n  selection: PropTypes.shape({\n    url: PropTypes.string,\n    externalUrl: PropTypes.string,\n    altText: PropTypes.bool,\n  }),\n  setSelection: PropTypes.func.isRequired,\n  images: PropTypes.shape({}).isRequired,\n  lmsEndpointUrl: PropTypes.string.isRequired,\n  editorType: PropTypes.string,\n};\n\nexport default injectIntl(ImageUploadModal);\n"],"mappings":"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"}