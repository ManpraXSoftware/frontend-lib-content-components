{"version":3,"file":"hooks.js","names":["_react","require","_tinyMCEStyles","_interopRequireDefault","_utils","_pluginConfig2","_module","_interopRequireWildcard","_tinyMCE","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","Symbol","iterator","constructor","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","toString","slice","name","Array","from","test","len","length","arr2","_i","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","apply","_objectSpread","target","arguments","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","Number","state","exports","StrictDict","isImageModalOpen","val","useState","isSourceCodeModalOpen","imageSelection","refReady","parseContentForLabels","_ref","_content","editor","updateContent","content","getContent","parsedLabels","split","updatedContent","label","startsWith","endsWith","previousLabel","nextLabel","concat","replace","replaceStaticwithAsset","_ref2","imageUrls","editorType","lmsEndpointUrl","imageSrcs","src","currentContent","staticFullUrl","isStatic","isExpandableAsset","assetSrc","substring","indexOf","assetName","staticName","url","displayName","currentSrc","setContent","setupCustomBehavior","_ref3","openImgModal","openSourceCodeModal","setImage","ui","registry","addButton","tinyMCE","buttons","imageUploadButton","icon","tooltip","onAction","editImageSettings","module","openModalWithSelectedImage","code","text","setupCodeFormatting","api","formatter","formatChanged","active","setActive","toggleCodeFormatting","toggle","undoManager","add","focus","addToggleButton","codeBlock","onSetup","toggleLabelFormatting","execCommand","addIcon","textToSpeechIcon","on","e","command","remove","removeProtocolFromUrl","editorConfig","_ref4","setEditorRef","textValue","images","studioEndpointUrl","isLibrary","placeholder","initializeEditor","setSelection","minHeight","_pluginConfig","pluginConfig","toolbar","config","plugins","imageToolbar","quickbarsInsertToolbar","quickbarsSelectionToolbar","onInit","evt","initialValue","init","skin","content_css","content_style","tinyMCEStyles","min_height","contextmenu","document_base_url","imagetools_cors_hosts","imagetools_toolbar","formats","inline","setup","fetchImageUrls","quickbars_insert_toolbar","quickbars_selection_toolbar","quickbars_image_toolbar","valid_children","valid_elements","entity_encoding","toolbar_sticky","prepareEditorRef","editorRef","useRef","useCallback","ref","current","_module$state$refRead","_module$state$refRead2","setRefReady","useEffect","imgModalToggle","_module$state$isImage","_module$state$isImage2","isImgOpen","setIsOpen","closeImgModal","sourceCodeModalToggle","_module$state$isSourc","_module$state$isSourc2","isSourceCodeOpen","closeSourceCodeModal","_ref5","imgHTML","selection","getNode","externalUrl","altText","alt","width","height","filterAssets","_ref6","assets","assetsList","values","asset","_asset$contentType","contentType","setAssetToStaticUrl","_ref7","editorValue","regExLmsEndpointUrl","RegExp","assetUrls","portableUrl","assetSrcs","assetBlockName","search","nameFromEditorSrc","nameFromStudioSrc","image","selectedImage","_module$state$imageSe","_module$state$imageSe2","clearSelection"],"sources":["../../../../src/editors/sharedComponents/TinyMceWidget/hooks.js"],"sourcesContent":["import {\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n} from 'react';\nimport tinyMCEStyles from '../../data/constants/tinyMCEStyles';\nimport { StrictDict } from '../../utils';\nimport pluginConfig from './pluginConfig';\nimport * as module from './hooks';\nimport tinyMCE from '../../data/constants/tinyMCE';\n\nexport const state = StrictDict({\n  isImageModalOpen: (val) => useState(val),\n  isSourceCodeModalOpen: (val) => useState(val),\n  imageSelection: (val) => useState(val),\n  refReady: (val) => useState(val),\n});\n\nexport const parseContentForLabels = ({ editor, updateContent }) => {\n  let content = editor.getContent();\n  if (content && content?.length > 0) {\n    const parsedLabels = content.split(/<label>|<\\/label>/gm);\n    let updatedContent;\n    parsedLabels.forEach((label, i) => {\n      if (!label.startsWith('<') && !label.endsWith('>')) {\n        let previousLabel = parsedLabels[i - 1];\n        let nextLabel = parsedLabels[i + 1];\n        if (!previousLabel.endsWith('<p>')) {\n          previousLabel = `${previousLabel}</p><p>`;\n          updatedContent = content.replace(parsedLabels[i - 1], previousLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n        if (!nextLabel.startsWith('</p>')) {\n          nextLabel = `</p><p>${nextLabel}`;\n          updatedContent = content.replace(parsedLabels[i + 1], nextLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n      }\n    });\n  } else {\n    updateContent(content);\n  }\n};\n\nexport const replaceStaticwithAsset = ({\n  editor,\n  imageUrls,\n  editorType,\n  lmsEndpointUrl,\n  updateContent,\n}) => {\n  let content = editor.getContent();\n  const imageSrcs = content.split('src=\"');\n  imageSrcs.forEach(src => {\n    const currentContent = content;\n    let staticFullUrl;\n    const isStatic = src.startsWith('/static/');\n    const isExpandableAsset = src.startsWith('/assets/') && editorType === 'expandable';\n    if ((isStatic || isExpandableAsset) && imageUrls.length > 0) {\n      const assetSrc = src.substring(0, src.indexOf('\"'));\n      const assetName = assetSrc.replace(/\\/assets\\/.+[^/]\\//g, '');\n      const staticName = assetSrc.substring(8);\n      imageUrls.forEach((url) => {\n        if (isExpandableAsset && assetName === url.displayName) {\n          staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n        } else if (staticName === url.displayName) {\n          staticFullUrl = url.staticFullUrl;\n          if (isExpandableAsset) {\n            staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n          }\n        }\n      });\n      if (staticFullUrl) {\n        const currentSrc = src.substring(0, src.indexOf('\"'));\n        content = currentContent.replace(currentSrc, staticFullUrl);\n        if (editorType === 'expandable') {\n          updateContent(content);\n        } else {\n          editor.setContent(content);\n        }\n      }\n    }\n  });\n};\n\nexport const setupCustomBehavior = ({\n  updateContent,\n  openImgModal,\n  openSourceCodeModal,\n  setImage,\n  editorType,\n  imageUrls,\n  lmsEndpointUrl,\n}) => (editor) => {\n  // image upload button\n  editor.ui.registry.addButton(tinyMCE.buttons.imageUploadButton, {\n    icon: 'image',\n    tooltip: 'Add Image',\n    onAction: openImgModal,\n  });\n  // editing an existing image\n  editor.ui.registry.addButton(tinyMCE.buttons.editImageSettings, {\n    icon: 'image',\n    tooltip: 'Edit Image Settings',\n    onAction: module.openModalWithSelectedImage({ editor, setImage, openImgModal }),\n  });\n  // overriding the code plugin's icon with 'HTML' text\n  editor.ui.registry.addButton(tinyMCE.buttons.code, {\n    text: 'HTML',\n    tooltip: 'Source code',\n    onAction: openSourceCodeModal,\n  });\n  // add a custom simple inline code block formatter.\n  const setupCodeFormatting = (api) => {\n    editor.formatter.formatChanged(\n      'code',\n      (active) => api.setActive(active),\n    );\n  };\n  const toggleCodeFormatting = () => {\n    editor.formatter.toggle('code');\n    editor.undoManager.add();\n    editor.focus();\n  };\n  editor.ui.registry.addToggleButton(tinyMCE.buttons.codeBlock, {\n    icon: 'sourcecode',\n    tooltip: 'Code Block',\n    onAction: toggleCodeFormatting,\n    onSetup: setupCodeFormatting,\n  });\n  // add a custom simple inline label formatter.\n  const toggleLabelFormatting = () => {\n    editor.execCommand('mceToggleFormat', false, 'label');\n  };\n  editor.ui.registry.addIcon('textToSpeech', tinyMCE.textToSpeechIcon);\n  editor.ui.registry.addButton('customLabelButton', {\n    icon: 'textToSpeech',\n    text: 'Label',\n    tooltip: 'Apply a \"Question\" label to specific text, recognized by screen readers. Recommended to improve accessibility.',\n    onAction: toggleLabelFormatting,\n  });\n  if (editorType === 'expandable') {\n    editor.on('init', () => {\n      module.replaceStaticwithAsset({\n        editor,\n        imageUrls,\n        editorType,\n        lmsEndpointUrl,\n        updateContent,\n      });\n    });\n  }\n  editor.on('ExecCommand', (e) => {\n    if (editorType === 'text' && e.command === 'mceFocus') {\n      module.replaceStaticwithAsset({ editor, imageUrls });\n    }\n    if (e.command === 'RemoveFormat') {\n      editor.formatter.remove('blockquote');\n      editor.formatter.remove('label');\n    }\n  });\n};\n\n// imagetools_cors_hosts needs a protocol-sanatized url\nexport const removeProtocolFromUrl = (url) => url.replace(/^https?:\\/\\//, '');\n\nexport const editorConfig = ({\n  editorType,\n  setEditorRef,\n  textValue,\n  images,\n  lmsEndpointUrl,\n  studioEndpointUrl,\n  isLibrary,\n  placeholder,\n  initializeEditor,\n  openImgModal,\n  openSourceCodeModal,\n  setSelection,\n  updateContent,\n  minHeight,\n}) => {\n  const {\n    toolbar,\n    config,\n    plugins,\n    imageToolbar,\n    quickbarsInsertToolbar,\n    quickbarsSelectionToolbar,\n  } = pluginConfig({ isLibrary, placeholder, editorType });\n  return {\n    onInit: (evt, editor) => {\n      setEditorRef(editor);\n      if (editorType === 'text') {\n        initializeEditor();\n      }\n    },\n    initialValue: textValue || '',\n    init: {\n      ...config,\n      skin: false,\n      content_css: false,\n      content_style: tinyMCEStyles,\n      min_height: minHeight,\n      contextmenu: 'link table',\n      document_base_url: lmsEndpointUrl,\n      imagetools_cors_hosts: [removeProtocolFromUrl(lmsEndpointUrl), removeProtocolFromUrl(studioEndpointUrl)],\n      imagetools_toolbar: imageToolbar,\n      formats: { label: { inline: 'label' } },\n      setup: module.setupCustomBehavior({\n        editorType,\n        updateContent,\n        openImgModal,\n        openSourceCodeModal,\n        lmsEndpointUrl,\n        setImage: setSelection,\n        imageUrls: module.fetchImageUrls(images),\n      }),\n      quickbars_insert_toolbar: quickbarsInsertToolbar,\n      quickbars_selection_toolbar: quickbarsSelectionToolbar,\n      quickbars_image_toolbar: false,\n      toolbar,\n      plugins,\n      valid_children: '+body[style]',\n      valid_elements: '*[*]',\n      entity_encoding: 'utf-8',\n      toolbar_sticky: false,\n    },\n  };\n};\n\nexport const prepareEditorRef = () => {\n  const editorRef = useRef(null);\n  const setEditorRef = useCallback((ref) => {\n    editorRef.current = ref;\n  }, []);\n  const [refReady, setRefReady] = module.state.refReady(false);\n  useEffect(() => setRefReady(true), []);\n  return { editorRef, refReady, setEditorRef };\n};\n\nexport const imgModalToggle = () => {\n  const [isImgOpen, setIsOpen] = module.state.isImageModalOpen(false);\n  return {\n    isImgOpen,\n    openImgModal: () => setIsOpen(true),\n    closeImgModal: () => setIsOpen(false),\n  };\n};\n\nexport const sourceCodeModalToggle = (editorRef) => {\n  const [isSourceCodeOpen, setIsOpen] = module.state.isSourceCodeModalOpen(false);\n  return {\n    isSourceCodeOpen,\n    openSourceCodeModal: () => setIsOpen(true),\n    closeSourceCodeModal: () => {\n      setIsOpen(false);\n      editorRef.current.focus();\n    },\n  };\n};\n\nexport const openModalWithSelectedImage = ({ editor, setImage, openImgModal }) => () => {\n  const imgHTML = editor.selection.getNode();\n  setImage({\n    externalUrl: imgHTML.src,\n    altText: imgHTML.alt,\n    width: imgHTML.width,\n    height: imgHTML.height,\n  });\n  openImgModal();\n};\n\nexport const filterAssets = ({ assets }) => {\n  let images = [];\n  const assetsList = Object.values(assets);\n  if (assetsList.length > 0) {\n    images = assetsList.filter(asset => asset?.contentType?.startsWith('image/'));\n  }\n  return images;\n};\n\nexport const setAssetToStaticUrl = ({ editorValue, assets, lmsEndpointUrl }) => {\n  /* For assets to remain usable across course instances, we convert their url to be course-agnostic.\n   * For example, /assets/course/<asset hash>/filename gets converted to /static/filename. This is\n   * important for rerunning courses and importing/exporting course as the /static/ part of the url\n   * allows the asset to be mapped to the new course run.\n  */\n\n  // TODO: should probably move this to when the assets are being looped through in the off chance that\n  // some of the text in the editor contains the lmsEndpointUrl\n  const regExLmsEndpointUrl = RegExp(lmsEndpointUrl, 'g');\n  let content = editorValue.replace(regExLmsEndpointUrl, '');\n\n  const assetUrls = [];\n  const assetsList = Object.values(assets);\n  assetsList.forEach(asset => {\n    assetUrls.push({ portableUrl: asset.portableUrl, displayName: asset.displayName });\n  });\n  const assetSrcs = typeof content === 'string' ? content.split(/(src=\"|src=&quot;|href=\"|href=&quot)/g) : [];\n  assetSrcs.forEach(src => {\n    if (src.startsWith('/asset') && assetUrls.length > 0) {\n      const assetBlockName = src.substring(src.indexOf('@') + 1, src.search(/(\"|&quot;)/));\n      const nameFromEditorSrc = assetBlockName.substring(assetBlockName.indexOf('@') + 1);\n      const nameFromStudioSrc = assetBlockName.substring(assetBlockName.indexOf('/') + 1);\n      let portableUrl;\n      assetUrls.forEach((url) => {\n        const displayName = url.displayName.replace(/\\s/g, '_');\n        if (displayName === nameFromEditorSrc || displayName === nameFromStudioSrc) {\n          portableUrl = url.portableUrl;\n        }\n      });\n      if (portableUrl) {\n        const currentSrc = src.substring(0, src.search(/(\"|&quot;)/));\n        const updatedContent = content.replace(currentSrc, portableUrl);\n        content = updatedContent;\n      }\n    }\n  });\n  return content;\n};\n\nexport const fetchImageUrls = (images) => {\n  const imageUrls = [];\n  images.forEach(image => {\n    imageUrls.push({ staticFullUrl: image.staticFullUrl, displayName: image.displayName });\n  });\n  return imageUrls;\n};\n\nexport const selectedImage = (val) => {\n  const [selection, setSelection] = module.state.imageSelection(val);\n  return {\n    clearSelection: () => setSelection(null),\n    selection,\n    setSelection,\n  };\n};\n"],"mappings":"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"}